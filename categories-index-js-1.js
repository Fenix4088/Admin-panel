(window.webpackJsonp=window.webpackJsonp||[]).push([[1],[,,,function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return a}));var n=i(9),s=i(11),o=i(12);function r(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class a{constructor(){r(this,"element",void 0),r(this,"components",{}),r(this,"subElements",{}),r(this,"listContainers",{}),r(this,"reorderingEvent",async e=>{const t=e.target.childNodes,i=[...t].map(e=>({id:e.dataset.id,weight:[...t].indexOf(e)+1}));try{await Object(n.a)("".concat("https://course-js.javascript.ru/","api/rest/subcategories"),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}),this.showNotificationMessage("Category order saved","success")}catch(e){this.showNotificationMessage("Category order NOT saved","error"),console.error("something went wrong",e)}}),r(this,"onPointerDown",e=>{if(e.target.closest(".category")&&!e.target.closest(".categories__sortable-list-item")){e.target.closest(".category").classList.toggle("category_open")}})}initEventListeners(){this.subElements.categoriesContainer.addEventListener("pointerdown",this.onPointerDown),document.addEventListener("sortable-list-reorder",this.reorderingEvent)}showNotificationMessage(e,t){new s.a(e,{type:t}).show()}async render(){const e=await this.getCategoriesData(),t=document.createElement("div");return t.innerHTML=this.template,this.element=t.firstElementChild,this.subElements=this.getSubElements(this.element),this.createCategorieWrap(e),this.listContainers=this.getAllListsContainers(this.element),this.getCategoriestList(e),this.initEventListeners(),this.element}get template(){return'  \n        <div class="categories">\n        <div class="content__top-panel">\n          <h1 class="page-title">Categories</h1>\n        </div>\n        <div data-element="categoriesContainer">\n            \x3c!-- Render categories menue here --\x3e\n        </div>\n        </div>\n      '}async getCategoriesData(){const e=this.getRequestLink("/api/rest/categories");return await Object(n.a)(e)}getRequestLink(e){const t=new URL(e,"".concat("https://course-js.javascript.ru/"));return t.searchParams.set("_sort","weight"),t.searchParams.set("_refs","subcategory"),t.href}createCategorieWrap(e=[]){const{categoriesContainer:t}=this.subElements,i=e.map(e=>'\n            <div class="category category_open" data-id="'.concat(e.id,'">\n            <header class="category__header">\n                ').concat(e.title,'\n            </header>\n            <div class="category__body">\n                <div class="subcategory-list">\n                    <div class="sortable-list" data-element="listContainer" data-index="').concat(e.id,'">\n\n                    </div>\n                    </div>\n                    </div>\n                    </div>')).join("");t.innerHTML=i}getCategoriestList(e){e.forEach(e=>{const t=this.getCategoriesListItem(e),i=new o.a({items:t});this.components[e.id]=i,this.listContainers[e.id].append(i.element)})}getCategoriesListItem(e){const{subcategories:t}=e;return t.map(e=>{const t=document.createElement("div");return t.innerHTML='\n            <li class="categories__sortable-list-item sortable-list__item" data-grab-handle="" data-id="'.concat(e.id,'">\n                <strong>').concat(e.title,"</strong>\n                <span><b>").concat(e.count,"</b> products</span>\n            </li>"),t.firstElementChild})}getSubElements(e){return[...e.querySelectorAll("[data-element]")].reduce((e,t)=>(e[t.dataset.element]=t,e),{})}getAllListsContainers(e){return[...e.querySelectorAll("[data-index]")].reduce((e,t)=>(e[t.dataset.index]=t,e),{})}destroy(){const{categoriesContainer:e}=this.subElements;e.removeEventListener("pointerdown",this.onPointerDown);for(const e of Object.values(this.components))e.destroy()}}},,,,,,function(e,t,i){"use strict";t.a=async function(e,t){let i,s;try{i=await fetch(e.toString(),t)}catch(e){throw new n(i,"Network error has occurred.")}if(!i.ok){let e=i.statusText;try{s=await i.json(),e=s.error&&s.error.message||s.data&&s.data.error&&s.data.error.message||e}catch(e){}let t="Error ".concat(i.status,": ").concat(e);throw new n(i,s,t)}try{return await i.json()}catch(e){throw new n(i,null,e.message)}};class n extends Error{constructor(e,t,i){var n,s,o;super(i),o="FetchError",(s="name")in(n=this)?Object.defineProperty(n,s,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[s]=o,this.response=e,this.body=t}}window.addEventListener("unhandledrejection",e=>{e.reason instanceof n&&alert(e.reason.message)})},,function(e,t,i){"use strict";function n(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}i.d(t,"a",(function(){return s}));class s{constructor(e,{duration:t=2e3,type:i="success"}={}){n(this,"element",void 0),s.notificationStatus&&s.notificationStatus.remove(),this.messageText=e,this.duration=t,this.type=i,this.render()}get markup(){return'\n          <div class="notification '.concat(this.type,'" style="--value:').concat(this.duration/1e3,'s">\n          <div class="timer"></div>\n          <div class="inner-wrapper">\n          <div class="notification-header">').concat(this.type,'</div>\n          <div class="notification-body">\n              ').concat(this.messageText,"\n          </div>\n          </div>\n      </div>\n        ")}render(){const e=document.createElement("div");e.innerHTML=this.markup,this.element=e.firstElementChild,s.notificationStatus=this.element}show(e=document.body){e.append(this.element),setTimeout(()=>{this.remove(),this.destroy()},this.duration)}remove(){this.element.remove()}destroy(){this.element=null,s.notificationStatus=null}}n(s,"notificationStatus",void 0)},function(e,t,i){"use strict";function n(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}i.d(t,"a",(function(){return s}));class s{constructor({items:e=[]}={}){n(this,"element",void 0),n(this,"elementInitialIndex",void 0),n(this,"pointerInitialShift",{}),n(this,"draggingElem",void 0),n(this,"placeholderElem",void 0),n(this,"onPointerDown",e=>{if(1!==e.which)return!1;const t=e.target.closest(".sortable-list__item");t&&(e.preventDefault(),e.target.closest("[data-grab-handle]")&&this.dragStart(t,e),e.target.closest("[data-delete-handle]")&&t.remove())}),n(this,"onDocumentPointerMove",e=>{const{clientX:t,clientY:i}=e;this.moveDraggingAt(t,i);const{firstElementChild:n,children:s}=this.element,{top:o}=n.getBoundingClientRect(),{bottom:r}=this.element.getBoundingClientRect();if(i<o)this.movePlaceholderAt(0);else if(i>r)this.movePlaceholderAt(s.length);else for(let e=0;e<s.length;e++){const t=s[e];if(t!==this.draggingElem){const{top:n,bottom:s}=t.getBoundingClientRect(),{offsetHeight:o}=t;if(i>n&&i<s){if(i<n+o/2){this.movePlaceholderAt(e);break}this.movePlaceholderAt(e+1);break}}}this.scrollIfCloseToWindowEdge(i)}),n(this,"onDocumentPointerUp",e=>{this.dragStop()}),this.items=e,this.render()}render(){this.element=document.createElement("ul"),this.element.className="sortable-list",this.addItems(),this.initEventListeners()}initEventListeners(){this.element.addEventListener("pointerdown",this.onPointerDown)}addItems(){for(let e of this.items)e.classList.add("sortable-list__item");this.element.append(...this.items)}dragStart(e,t){const{clientX:i,clientY:n}=t;this.elementInitialIndex=[...this.element.children].indexOf(e),this.pointerInitialShift={x:i-e.getBoundingClientRect().x,y:n-e.getBoundingClientRect().y},this.draggingElem=e,this.placeholderElem=document.createElement("li"),this.placeholderElem.className="sortable-list__placeholder",e.style.width="".concat(e.offsetWidth,"px"),e.style.height="".concat(e.offsetHeight,"px"),this.placeholderElem.style.width=e.style.width,this.placeholderElem.style.height=e.style.height,e.classList.add("sortable-list__item_dragging"),e.after(this.placeholderElem),this.element.append(e),this.moveDraggingAt(i,n),document.addEventListener("pointermove",this.onDocumentPointerMove),document.addEventListener("pointerup",this.onDocumentPointerUp)}moveDraggingAt(e,t){this.draggingElem.style.left=e-this.pointerInitialShift.x+"px",this.draggingElem.style.top=t-this.pointerInitialShift.y+"px"}movePlaceholderAt(e){const t=this.element.children[e];t!==this.placeholderElem&&this.element.insertBefore(this.placeholderElem,t)}dragStop(){const e=[...this.element.children].indexOf(this.placeholderElem);this.placeholderElem.replaceWith(this.draggingElem),this.draggingElem.classList.remove("sortable-list__item_dragging"),this.draggingElem.style.left="",this.draggingElem.style.top="",this.draggingElem.style.width="",this.draggingElem.style.height="",document.removeEventListener("pointermove",this.onDocumentPointerMove),document.removeEventListener("pointerup",this.onDocumentPointerUp),this.draggingElem=null,e!==this.elementInitialIndex&&this.element.dispatchEvent(new CustomEvent("sortable-list-reorder",{bubbles:!0,detail:{from:this.elementInitialIndex,to:e}}))}scrollIfCloseToWindowEdge(e){e<20?window.scrollBy(0,-10):e>document.documentElement.clientHeight-20&&window.scrollBy(0,10)}remove(){this.element.remove(),document.removeEventListener("pointermove",this.onDocumentPointerMove),document.removeEventListener("pointerup",this.onDocumentPointerUp)}destroy(){this.remove()}}}]]);
//# sourceMappingURL=categories-index-js-1.js.map