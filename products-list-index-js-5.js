(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{10:function(t,e,s){"use strict";s.d(e,"a",(function(){return i}));var n=s(9);function a(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class i{constructor(t=[],{url:e="",sorted:s={id:t.find(t=>t.sortable).id,order:"asc"},isSortLocally:n=!1,step:i=20,start:r=0,end:l=r+i,clickableRow:o=!0}={}){a(this,"element",void 0),a(this,"subElements",{}),a(this,"data",[]),a(this,"loading",!1),a(this,"step",20),a(this,"start",0),a(this,"end",this.start+this.step),a(this,"onWindowScroll",async()=>{const{bottom:t}=this.element.getBoundingClientRect(),{id:e,order:s}=this.sorted;if(t<document.documentElement.clientHeight&&!this.loading&&this.sortLocally){this.start=this.end,this.end=this.start+this.step,this.loading=!0;const t=await this.loadData(e,s,this.start,this.end);this.update(t),this.loading=!1}}),a(this,"onSortClick",t=>{const e=t.target.closest('[data-sortable="true"]');if(e){const{id:t,order:s}=e.dataset,n=(t=>({asc:"desc",desc:"asc"}[t]))(s);this.sorted={id:t,order:n},e.dataset.order=n,e.append(this.subElements.arrow),this.isSortLocally?this.sortLocally(t,n):this.sortOnServer(t,n,1,1+this.step)}}),this.headersConfig=t,this.url=new URL(e,"https://course-js.javascript.ru"),this.sorted=s,this.isSortLocally=n,this.clickableRow=o,this.step=i,this.start=r,this.end=l,this.render()}async render(){const{id:t,order:e}=this.sorted,s=document.createElement("div");s.innerHTML=this.getTable();const n=s.firstElementChild;this.element=n,this.subElements=this.getSubElements(n);const a=await this.loadData(t,e,this.start,this.end);return this.renderRows(a),this.initEventListeners(),this.element}async loadData(t,e,s=this.start,a=this.end){const{loading:i}=this.subElements;i.classList.remove("hide"),this.url.searchParams.set("_sort",t),this.url.searchParams.set("_order",e),this.url.searchParams.set("_start",s),this.url.searchParams.set("_end",a),this.element.classList.add("sortable-table_loading");const r=await Object(n.a)(this.url);return this.element.classList.remove("sortable-table_loading"),i.classList.add("hide"),r}addRows(t){this.data=t,this.subElements.body.innerHTML=this.getTableRows(t)}update(t){const e=document.createElement("div");this.data=[...this.data,...t],e.innerHTML=this.getTableRows(t),this.subElements.body.append(...e.childNodes)}getTableHeader(){return'<div data-element="header" class="sortable-table__header sortable-table__row">\n      '.concat(this.headersConfig.map(t=>this.getHeaderRow(t)).join(""),"\n    </div>")}getHeaderRow({id:t,title:e,sortable:s}){const n=this.sorted.id===t?this.sorted.order:"asc";return'\n      <div class="sortable-table__cell" data-id="'.concat(t,'" data-sortable="').concat(s,'" data-order="').concat(n,'">\n        <span>').concat(e,"</span>\n        ").concat(this.getHeaderSortingArrow(t),"\n      </div>\n    ")}getHeaderSortingArrow(t){return(this.sorted.id===t?this.sorted.order:"")?'<span data-element="arrow" class="sortable-table__sort-arrow">\n          <span class="sort-arrow"></span>\n        </span>':""}getTableBody(t){return'\n      <div data-element="body" class="sortable-table__body">\n        '.concat(this.getTableRows(t),"\n      </div>")}getTableRows(t){return t.map(e=>this.clickableRow?'<a href="/products/'.concat(e.id,'" class="sortable-table__row">\n          ').concat(this.getTableRow(e,t),"\n        </a>"):'<div href="/products/'.concat(e.id,'" class="sortable-table__row">\n          ').concat(this.getTableRow(e,t),"\n        </div>")).join("")}getTableRow(t){return this.headersConfig.map(({id:t,template:e})=>({id:t,template:e})).map(({id:e,template:s})=>s?s(t[e]):'<div class="sortable-table__cell">'.concat(t[e],"</div>")).join("")}getTable(){return'\n      <div class="sortable-table">\n        '.concat(this.getTableHeader(),"\n        ").concat(this.getTableBody(this.data),'\n\n        <div data-element="loading" class="loading-line sortable-table__loading-line hide"></div>\n\n        <div data-element="emptyPlaceholder" class="sortable-table__empty-placeholder">\n          <div class="sortable-table__placeholder-wrapper">\n            <p>Не найдено товаров удовлетворяющих выбранному критерию</p>\n            <button data-element="clearFilterBtn" type="button" class="button-primary-outline">Очистить фильтры</button>\n          </div>\n        </div>\n      </div>')}initEventListeners(){this.subElements.header.addEventListener("pointerdown",this.onSortClick),document.addEventListener("scroll",this.onWindowScroll)}sortLocally(t,e){const s=this.sortData(t,e);this.subElements.body.innerHTML=this.getTableBody(s)}async sortOnServer(t,e,s,n){const a=await this.loadData(t,e,s,n);this.renderRows(a)}renderRows(t){t.length?(this.element.classList.remove("sortable-table_empty"),this.addRows(t)):this.element.classList.add("sortable-table_empty")}sortData(t,e){const s=[...this.data],n=this.headersConfig.find(e=>e.id===t),{sortType:a,customSorting:i}=n,r="asc"===e?1:-1;return s.sort((e,s)=>{switch(a){case"number":return r*(e[t]-s[t]);case"string":return r*e[t].localeCompare(s[t],"ru");case"custom":return r*i(e,s);default:return r*(e[t]-s[t])}})}getSubElements(t){return[...t.querySelectorAll("[data-element]")].reduce((t,e)=>(t[e.dataset.element]=e,t),{})}remove(){this.element.remove(),document.removeEventListener("scroll",this.onWindowScroll)}destroy(){this.remove(),this.subElements={}}}},7:function(t,e,s){"use strict";s.r(e),s.d(e,"default",(function(){return o}));s(9);var n=[{id:"images",title:"Image",sortable:!1,template:t=>{if(t.length>0)return'\n            <div class="sortable-table__cell">\n              <img class="sortable-table-image" alt="Image" src="'.concat(t[0].url,'">\n            </div>\n          ')}},{id:"title",title:"Name",sortable:!0,sortType:"string"},{id:"subcategory",id:"subcategory",title:"Category",sortable:!1,sortType:"string",template:t=>'<div class="sortable-table__cell">\n     <span data-tooltip=\'\n     <div class="sortable-table-tooltip">\n       <span class="sortable-table-tooltip__category">'.concat(t.category.title,'</span> /\n       <b class="sortable-table-tooltip__subcategory">').concat(t.title,"</b>\n     </div>'>").concat(t.title,"</span>\n     </div>")},{id:"quantity",title:"Quantity",sortable:!0,sortType:"number"},{id:"price",title:"Price",sortable:!0,sortType:"number",template:t=>'<div class="sortable-table__cell">$'+t+"</div>"},{id:"status",title:"Status",sortable:!0,sortType:"number",template:t=>'<div class="sortable-table__cell">\n          '.concat(t>0?"Active":"Inactive","\n        </div>")}];function a(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class i{constructor({min:t=100,max:e=200,formatValue:s=(t=>"$"+t),selected:n={from:t,to:e}}={}){a(this,"element",void 0),a(this,"subElements",{}),a(this,"shiftX",void 0),a(this,"dragging",void 0),a(this,"clickDown",t=>{t.preventDefault();const e=t.target,{left:s,right:n}=e.getBoundingClientRect();e===this.subElements.thumbLeft?this.shiftX=n-t.clientX:this.shiftX=s-t.clientX,this.dragging=e,this.element.classList.add("range-slider_dragging"),document.addEventListener("pointermove",this.pointerMove),document.addEventListener("pointerup",this.clickUp)}),a(this,"pointerMove",t=>{t.preventDefault();const{left:e,right:s,width:n}=this.subElements.inner.getBoundingClientRect();if(this.dragging===this.subElements.thumbLeft){let s=(t.clientX-e+this.shiftX)/n;s<0&&(s=0),s*=100;let a=parseFloat(this.subElements.thumbRight.style.right);s+a>100&&(s=100-a),this.dragging.style.left=this.subElements.progress.style.left=s+"%",this.subElements.from.innerHTML=this.formatValue(this.getValue().from)}if(this.dragging===this.subElements.thumbRight){let e=(s-t.clientX-this.shiftX)/n;e<0&&(e=0),e*=100;let a=parseFloat(this.subElements.thumbLeft.style.left);a+e>100&&(e=100-a),this.dragging.style.right=this.subElements.progress.style.right=e+"%",this.subElements.to.innerHTML=this.formatValue(this.getValue().to)}}),a(this,"clickUp",t=>{this.element.classList.remove("range-slider_dragging"),document.removeEventListener("pointermove",this.pointerMove),document.removeEventListener("pointerup",this.clickUp),this.element.dispatchEvent(new CustomEvent("range-select",{detail:this.getValue(),bubbles:!0}))}),this.min=t,this.max=e,this.formatValue=s,this.selected=n,this.render()}get markup(){const{from:t,to:e}=this.selected;return'\n          <div class="range-slider">\n              <span data-element="from">'.concat(this.formatValue(t),'</span>\n              <div data-element="inner" class="range-slider__inner">\n                  <span data-element="progress" class="range-slider__progress"></span>\n                  <span data-element="thumbLeft" class="range-slider__thumb-left"></span>\n                  <span data-element="thumbRight" class="range-slider__thumb-right"></span>\n              </div>\n              <span data-element="to">').concat(this.formatValue(e),"</span>\n          </div>")}render(){const t=document.createElement("div");t.innerHTML=this.markup,this.element=t.firstElementChild,this.subElements=this.getSubElements(this.element),this.initEventListeners(),this.update()}getSubElements(t){return[...t.querySelectorAll("[data-element]")].reduce((t,e)=>(t[e.dataset.element]=e,t),{})}initEventListeners(){const{thumbLeft:t,thumbRight:e}=this.subElements;t.addEventListener("pointerdown",this.clickDown),e.addEventListener("pointerdown",this.clickDown)}getValue(){const t=this.max-this.min,{left:e}=this.subElements.thumbLeft.style,{right:s}=this.subElements.thumbRight.style;return{from:Math.round(this.min+.01*parseFloat(e)*t),to:Math.round(this.max-.01*parseFloat(s)*t)}}remove(){this.element.remove()}destroy(){this.remove(),document.removeEventListener("pointermove",this.onThumbPointerMove),document.removeEventListener("pointerup",this.onThumbPointerUp)}update(){const t=this.max-this.min,e=Math.floor((this.selected.from-this.min)/t*100)+"%",s=Math.floor((this.max-this.selected.to)/t*100)+"%";this.subElements.progress.style.left=e,this.subElements.progress.style.right=s,this.subElements.thumbLeft.style.left=e,this.subElements.thumbRight.style.right=s}}var r=s(10);function l(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class o{constructor(){l(this,"element",void 0),l(this,"subElements",{}),l(this,"components",{}),l(this,"filterData",{filterName:"",filterStatus:"",doubleSliderData:{from:0,to:0}}),l(this,"onFilterInput",t=>{const{filterName:e,filterStatus:s}=this.subElements,n=t.target;n===e?this.filterData.filterName=n.value.trim():n===s&&(this.filterData.filterStatus=n.value),this.updateTable()}),l(this,"onRangeSelect",t=>{const{from:e,to:s}=t.detail;this.filterData.doubleSliderData.from=e,this.filterData.doubleSliderData.to=s,this.updateTable()}),l(this,"clearFilters",()=>{const{filterName:t,filterStatus:e}=this.subElements,{min:s,max:n}=this.components.doubleSlider;t.value="",e.value="",this.filterData.filterName="",this.filterData.filterStatus="";const{from:a,to:i}=this.components.doubleSlider.subElements;a.innerHTML="$".concat(s),i.innerHTML="$".concat(n),this.components.doubleSlider.update(),this.filterData.doubleSliderData.from=0,this.filterData.doubleSliderData.to=4e3,this.updateTable()})}initEventListeners(){const{filter:t}=this.subElements,{doubleSlider:e}=this.components,{clearFilterBtn:s}=this.components.sortableTable.subElements;t.addEventListener("input",this.onFilterInput),e.element.addEventListener("range-select",this.onRangeSelect),s.addEventListener("pointerdown",this.clearFilters)}async updateTable(){const{sorted:t,step:e}=this.components.sortableTable,s=this.createURL();this.components.sortableTable.url.href=s,await this.components.sortableTable.sortOnServer(t.id,t.order,0,e)}createURL(){const{filterName:t,filterStatus:e,doubleSliderData:{from:s,to:n}}=this.filterData,a=new URL("api/rest/products?_embed=subcategory.category","https://course-js.javascript.ru/");return a.searchParams.set("price_gte",s),a.searchParams.set("price_lte",n),""!==t.trim()&&a.searchParams.set("title_like",t),""!=e&&a.searchParams.set("status",e),a.href}async render(){const t=document.createElement("div");return t.innerHTML=this.template,this.element=t.firstElementChild,this.subElements=this.getSubElements(this.element),this.initComponents(),await this.renderComponents(),this.initEventListeners(),this.element}get template(){return'\n    <div class="products-list">\n      <div class="content__top-panel">\n        <h1 class="page-title">Товары</h1>\n        <a href="/products/add" class="button-primary">Добавить товар</a>\n      </div>\n      <div class="content-box content-box_small">\n      <form data-element="filter" class="form-inline">\n          <div class="form-group">\n            <label class="form-label">Сортировать по:</label>\n            <input type="text" data-element="filterName" class="form-control" placeholder="Название товара">\n          </div>\n          <div class="form-group" data-element="sliderContainer">\n            <label class="form-label">Цена:</label>\n              \x3c!-- //! DoubleSlider --\x3e\n          </div>\n          <div class="form-group">\n            <label class="form-label">Статус:</label>\n            <select class="form-control" data-element="filterStatus">\n              <option value="" selected="">Любой</option>\n              <option value="1">Активный</option>\n              <option value="0">Неактивный</option>\n            </select>\n          </div>\n        </form>\n      </div>\n      <div data-element="productsContainer" class="products-list__container">\n        \x3c!--//! SortableTable--\x3e\n      </div>\n    </div>\n    '}initComponents(){this.components.doubleSlider=new i({min:0,max:4e3}),this.filterData.doubleSliderData.from=this.components.doubleSlider.min,this.filterData.doubleSliderData.to=this.components.doubleSlider.max,this.components.sortableTable=new r.a(n,{url:"api/rest/products?_embed=subcategory.category"})}async renderComponents(){this.subElements.sliderContainer.append(this.components.doubleSlider.element),this.subElements.productsContainer.append(this.components.sortableTable.element)}getSubElements(t){return[...t.querySelectorAll("[data-element]")].reduce((t,e)=>(t[e.dataset.element]=e,t),{})}remove(){const{filter:t}=this.subElements,{clearFilterBtn:e}=this.components.sortableTable.subElements;t.removeEventListener("input",this.onFilterInput),e.removeEventListener("pointerdown",this.clearFilters),this.element=null}destroy(){this.remove();for(const t of Object.values(this.components))t.destroy()}}},9:function(t,e,s){"use strict";e.a=async function(t,e){let s,a;try{s=await fetch(t.toString(),e)}catch(t){throw new n(s,"Network error has occurred.")}if(!s.ok){let t=s.statusText;try{a=await s.json(),t=a.error&&a.error.message||a.data&&a.data.error&&a.data.error.message||t}catch(t){}let e="Error ".concat(s.status,": ").concat(t);throw new n(s,a,e)}try{return await s.json()}catch(t){throw new n(s,null,t.message)}};class n extends Error{constructor(t,e,s){var n,a,i;super(s),i="FetchError",(a="name")in(n=this)?Object.defineProperty(n,a,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[a]=i,this.response=t,this.body=e}}window.addEventListener("unhandledrejection",t=>{t.reason instanceof n&&alert(t.reason.message)})}}]);
//# sourceMappingURL=products-list-index-js-5.js.map